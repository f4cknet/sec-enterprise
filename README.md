# sec-enterprise
## 前言
编写该指南是一个相对大的工程，本指南大部分都是个人主观的见解，我不觉得我是一个全面的安全人，一个人编写肯定会有一些不足或者错误的点，我希望有安全圈的小伙伴加入进来一起编写该指南。 目前规划的内容主要涉及（应用安全、数据安全、基础安全、应急响应、人员安全、安全合规）6大块，目标是帮助中小型企业摸清自身的风险并快速搭建起自己的`检测/防御/合规/响应`体系。
![](https://m1nzhi.oss-cn-beijing.aliyuncs.com/secinstruc.png)

**协同编写方式**
1. 本指南和Github `f4cknet/sec-enterprise` 保持同步，小伙伴们可以在该仓库的[issue](https://github.com/f4cknet/sec-enterprise/issues/new)中编写相关内容。比如觉得哪里写的不对，你建议应该怎么写？
2. 私下交流：通过infosecnote公众号发我私信、或者发送邮件到zmzsg100@gmail.com和我交换私人微信。


本指南不涉及具体的攻击性技术研究，对于非安全公司，特别是中小型企业而言，安全攻击研究过于奢侈，企业应该快速构建起自己的检测、防御和响应能力，所以本指南不过多阐述攻击性技术。

## 聊一聊安全成本
我想很多企业都会面临这个问题，安全投入成本到底应该是多少？如何度量在安全上投入的成本和回报(ROI)？企业安全是不是发现漏洞然后修复漏洞，再设置一下防火墙之类的工作？

圈内有很多人调侃，不出安全事故老板不知道你的价值，出了安全事故老板又觉得招你没有价值。所以怎么量化安全工作的价值，是安全Leader需要考虑的事。笔者认为安全ROI本质上来说是（安全风险所造成的损失-安全成本），如果结果是正值则是安全投入是成功的，如果是负值则安全投入是失败的。但安全风险造成的损失很难定量计算，所以安全ROI难以度量是业内的通病。经过我的思考，总结出两个维度的安全成本的评估方法：`1、业务规模；2、当前风险`。两种方法都存在一些弊端，结合使用可能效果会更好。

### 通过业务规模考量安全成本
该方法优势：简单粗暴，只需要根据业务规模来估算成本

该方法劣势：没有具体的依据，无法计算出安全成本具体的值，只能根据公司的资金情况而定。比如处在2阶段的企业需要招聘2个人，而这两个岗位如何定薪资，有了人之后又需要在检测能力和防御能力以及应急响应能力上投入，无法进行人员成本和检测工具、防御产品之间的分配。

以下将业务规模分为4个阶段：

1. 处于业务摸索阶段的初创型企业，即使有资本注入，但这个阶段的企业不应该把成本过于浪费在安全上。安全是基于业务的，如果连业务方向都不明确，谈何安全。这种情况下可以无需在安全上投入成本，等找到业务方向后在开始组建安全团队。

2. 已经有明确的业务方向的创业企业，如果没有资本注入且营收情况不佳，应该至少需要一个安全工程师，这个工程师无需精通安全某个细分领域，但需要具备安全体系的大局观，需要具备企业安全风险评估风险的能力并给出风险处置方案或者建议。如果说资金充裕（业务盈利或者有融资），应该招聘至少一个安全合规，一个安全技术。这类公司一般公司规模100-500人，安全人员至少需要2个，安全团队在企业组织架构中应该是和运维平级的团队。遇到过很多企业将安全置于运维团队下管理，这绝对是无法顺利开展安全工作的。
3. 如果是融资型企业（大多互联网公司都会融资），并且已经到C轮之后了（独角兽企业），那么公司的业务肯定已经很明确了，比如xx社交软件、xx新媒体平台、xx线上问诊等等。这类公司大多都奔着上市去，那么要上市必然会受到更多的监管和黑客的攻击，不管业务盈利情况怎么样，企业高层都应该把安全重视起来。至少要组建一个初具规模安全团队（5-10人），1个负责人，1个应用安全，1个安全合规，1个数据安全，1个安全运维/应急）。
4. 如果企业已经上市，或者用户庞大（千万用户以上），比如蚂蚁虽然没上市，但是用户量巨大，盈利非常可观。这种超越了独角兽的企业，应该投入更多的安全成本。至少安全团队（20人以上）：1个安全负责人，2～4个应用安全，2-3个安全合规，1-2个数据安全，2-4个安全运维/应急。

## 应用安全
### 简述
对于互联网企业而言，公司的营收主要看面向互联网用户的业务系统。所以在这些业务系统上应该投入足够的安全精力和成本。如果初创型公司有足够的资金，还没有找到业务方向处在试错阶段，那么可以先招一个懂安全测试的人。如果没有足够的资金，那么可以先把安全滞后，等业务起来再说。而对于中小型公司，业务方向确定，有持续稳定的营收，那么可以增加安全成本，包括招聘更专业的安全人员、购买商业安全检测工具、安全防护工具等。

### 业务系统分级
由于互联网企业的营收收入主要来自核心的业务系统，所以企业应该对业务系统进行分级，越核心的系统投入的安全成本自然应该更多，安全控制措施或安全策略就应该更加严格。系统分级可以参考GB/T22240-2020。

信息系统的定级不应该是安全工程师来实施，安全人员要做的事是根据业内标准、指南，梳理出一份适合自身企业的定级指南，并对公司全体项目经理、产品经理进行宣贯。至于这个事情为什么非要项目进经理和产品经理去做，从根本上来说，项目经理和产品经理是最了解项目需求的，信息系统的目标定位、用户群体都是定级的指标。如果每个项目都要安全工程来定级，那一个公司那么多项目，安全工程师还不累死？

每个公司情况不一样，业务系统定级可以做成功能集成到SDLC平台或者软件开发流程管理平台，实在不行也应该将定级结果写在项目文档中。

系统定级可以从3个维度来量化：1.可用性；2.数据敏感型；3.受威胁等级

**1.可用性**
系统可用性占比40%，简单的可以理解为RTO。

![](https://m1nzhi.oss-cn-beijing.aliyuncs.com/keyongxing.png)

**2.数据重要性**
简单的说就是评估业务系统中的数据敏感等级。产品经理进行数据重要性评估时需要重点考虑以下几个方面：

- 业务系统中的数据等级是什么？一般将数据分为：机密、私有、敏感、公开
- 数据泄漏对公司造成的影响或损失有多大？

![](https://m1nzhi.oss-cn-beijing.aliyuncs.com/shujuzhongyaoxing.png)

**3.威胁程度**
主要的几个判断指标：是否互联网能访问，是否需要身份认证，是否与外部有数据交互

![](https://m1nzhi.oss-cn-beijing.aliyuncs.com/weixiechengdu.png)

### 漏洞定级
漏洞的定级主要有3个指标：被利用难度、被利用后的影响程度、业务系统所处的环境（内网/外网）。根据3个指标，将漏洞分为严重、高危、中危、低危4个级别。具体的指标内容这里不过多阐述，百度搜一下GB/T30279-2020。这里引用了蚂蚁集团的漏洞评级标准

**严重**
```
1. 直接获取核心服务器权限漏洞，包括但不限于内存破坏、直接上传WEBSHELL、利用逻辑缺陷任意加载 远程代码 等可利用的远程代码执行漏洞。
2. 核心敏感数据信息泄露漏洞，包括但不限于系统权限控制不严格等导致的敏感数据泄露漏洞。
3. 核心业务的逻辑漏洞，能够大量获取利益造成公司、用户损失的漏洞，包括但不限于账密校验逻辑、核心数据接口验证逻辑、支付逻辑漏洞等。
4. 可以直接命令执行的SQL注入漏洞；核心DB（资金、身份、交易相关）利用难度低的 SQL 注入，可获取大量核心用户的身份信息、订单信息、银行卡信息等接口问题引起的敏感信息泄露。
```

**高危**
```
1. 直接获取普通服务器或客户端权限漏洞，包括但 不限于内存破坏、逻辑权限等可利用的远程代码执行漏洞。
2. 重要敏感数据信息泄露漏洞，包括但不限于重要用户信息、订单信息、数据文件信息等。
3. 本地代码执行漏洞，包括但不限于内存破坏、类型混淆、整数问题等导致的可利用本地代码执行漏洞。
4. 不需交互导致的重点业务漏洞，包括但不限于存储XSS、文 件遍历、参数处理不当导致的远程拒绝服务漏洞。
5. 核心业务的逻辑漏洞，能够有限获取利益造成公司、用户损失的漏洞。
6. 核心DB（资金、身份、交易相关）利用难度高的 SQL 注入，无法直接获取大量敏感数据。非核心DB（不包含用户身份、资金、交易相关，只有业务数据）利用难度低的SQL注入，可以获取大量业务数据的漏洞。
```
**中危**
```
1. 需交互才能对用户产生危害的安全漏洞、包括但不限于反射XSS、json劫持、CRLF、敏感操作的CSRF等。
2. 普通信息 泄露漏洞、包括但不限于非个人登陆后泄露的手机号、姓名、交易号等个人信息。
3. 远程拒绝服务漏洞，包括但不限于攻击接口、页面、组件导致的拒绝服务等。
4. 非核心业务的逻辑漏洞，包括但不限于组件导出、权限控 制不当导致的 泄露问题、重定向漏洞等。
5. 存储xss不能影响全量用户或不能提供输入点的或独立域名有httponly防护的应用
6. 一般风险的业务安全问题。如营销活动作弊、业务规则绕过
7. 非核心DB（不包含用户身份、资金、交易相关，只有业务数据）利用难度高的SQL注入，不可直接获取大量业务数据。
```
**低危**
```
在特殊条件下才能获取用户信息的安全漏洞，包括但不限于特定浏览器下 的反射XSS、存储XSS。 基本无影响的信息泄露漏洞，包括但不限于服务器物理路径、phpinfo、边缘系统文件、本地日志等。 本地拒绝服务漏洞，包括但不限于PC端、 移动端本地组件、进程的拒绝服务。 可能存在安全隐患但利用成本很高的漏洞，包括但不限于特殊情况下 的中间人攻击、需要用户连续交互的敏感操作安全漏洞。 低风险业务安全问题。如恶意注册、违规违禁、商户欺诈，套现等 越权低危情况：A、攻击门槛较高 B、无敏感信息 C、用户无感知，非重要功能
```
